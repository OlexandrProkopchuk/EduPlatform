@model EduPlatform.Data.ViewModels.TakeQuizViewModel
@{
    ViewData["Title"] = Model.Title;
    var hasQuestions = Model.Questions?.Any() == true;
}
@if (!hasQuestions)
{
    <div class="alert alert-warning">Для цього тесту немає питань.</div>
}
else
{
    <form asp-action="Submit" method="post" id="quizForm">
        <input type="hidden" name="QuizId" value="@Model.QuizId" />
        <div id="q-container">
            @for (int i = 0; i < Model.Questions.Count; i++)
            {
                var q = Model.Questions[i];
                <div class="question-step" data-index="@i" style="display:@(i == 0 ? "block" : "none")">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <div class="text-muted">Питання @(i + 1) з @Model.Questions.Count</div>
                        <div class="progress w-50" style="height:6px">
                            <div id="progressBar" class="progress-bar" style="width:@(100 * (i + 1) / Model.Questions.Count)%"></div>
                        </div>
                    </div>

                    <h5 class="mb-3">@q.Text</h5>

                    @if (q.Options == null || !q.Options.Any())
                    {
                        <div class="alert alert-secondary">Немає варіантів.</div>
                    }
                    else
                    {
                        foreach (var opt in q.Options)
                        {
                            <div class="form-check mb-2">
                                <input class="form-check-input"
                                       type="radio"
                                       name="Answers[@q.Id]"
                                       value="@opt.Id"
                                       id="q@q.Id-op@opt.Id" />
                                <label class="form-check-label" for="q@q.Id-op@opt.Id">@opt.Text</label>
                            </div>
                        }
                    }
                </div>
            }
        </div>

        <div class="d-flex justify-content-between mt-3">
            <button type="button" class="btn btn-outline-secondary" id="btnPrev" disabled>Назад</button>
            <button type="button" class="btn btn-primary" id="btnNext">Далі</button>
            <button type="submit" class="btn btn-success d-none" id="btnSubmit">Завершити</button>
        </div>
    </form>

    <script>
        (() => {
            const steps = Array.from(document.querySelectorAll('.question-step'));
            let i = 0;

            const btnPrev = document.getElementById('btnPrev');
            const btnNext = document.getElementById('btnNext');
            const btnSubmit = document.getElementById('btnSubmit');
            const progressBars = document.querySelectorAll('#progressBar');

            function show(idx) {
                steps.forEach((s, k) => s.style.display = (k === idx ? 'block' : 'none'));
                btnPrev.disabled = idx === 0;
                const last = idx === steps.length - 1;
                btnNext.classList.toggle('d-none', last);
                btnSubmit.classList.toggle('d-none', !last);

                // оновити прогрес
                const pct = Math.round(100 * (idx + 1) / steps.length);
                progressBars.forEach(pb => pb.style.width = pct + '%');
            }

            btnPrev.addEventListener('click', () => { if (i > 0) { i--; show(i); }});
            btnNext.addEventListener('click', () => { if (i < steps.length - 1) { i++; show(i); }});
            show(i);
        })();
    </script>
}
